"use strict";(()=>{var e={};e.id=713,e.ids=[713],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},835:(e,t,r)=>{r.r(t),r.d(t,{config:()=>c,default:()=>l,routeModule:()=>d});var n={};r.r(n),r.d(n,{config:()=>s,default:()=>u});var i=r(1802),a=r(7153),o=r(6249);let s={api:{bodyParser:{sizeLimit:"6mb"}}};async function u(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});let r=process.env.OPENAI_API_KEY;if(!r)return console.error("❌ OPENAI_API_KEY is missing"),t.status(500).json({error:"Server is missing OPENAI_API_KEY. Check .env.local."});let{imageData:n}=e.body;if(!n)return t.status(400).json({error:"Missing image data"});console.log("✅ /api/crystal-identify received image, length:",n.length);try{let e;let i=`
You are a crystal identification expert and energy guide.

Given a clear photo of a crystal, respond ONLY as JSON in this exact shape:

{
  "crystalName": "Name of the most likely crystal (short)",
  "chakra": "Primary chakra or chakras it supports (short)",
  "uses": "1–3 concise sentences describing its metaphysical/energetic uses, in warm, modern language."
}

Do not include any extra commentary or fields. If you're unsure, give your best intuitive guess and say that you're estimating in the description.
`,a=await fetch("https://api.openai.com/v1/responses",{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-4.1-mini",input:[{role:"system",content:i},{role:"user",content:[{type:"input_text",text:"Please identify this crystal, its chakra alignment, and key energetic uses."},{type:"input_image",image_url:n}]}]})});if(!a.ok){let e=await a.text();return console.error("❌ OpenAI error:",a.status,e),t.status(500).json({error:"AI could not analyze the image. Try again later."})}let o=await a.json(),s=o.output?.[0]?.content?.[0]?.text??o.output?.[0]?.content?.[0]?.output_text??"";try{e=JSON.parse(s)}catch(t){console.error("⚠️ Failed to parse OpenAI JSON:",t,s),e={crystalName:"Intuitive Ally",chakra:"Heart",uses:"Helps soften your energy, open the heart, and bring you back into gentle self-compassion. (Fallback description.)"}}return t.status(200).json(e)}catch(e){return console.error("\uD83D\uDD25 Error in /api/crystal-identify:",e),t.status(500).json({error:"Server error while identifying the crystal."})}}let l=(0,o.l)(n,"default"),c=(0,o.l)(n,"config"),d=new i.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/crystal-identify",pathname:"/api/crystal-identify",bundlePath:"",filename:""},userland:n})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=835);module.exports=r})();